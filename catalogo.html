<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Catálogo de Produtos</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js/dist/umd/supabase.js"></script>
</head>
<body>
    <h1>Catálogo de Produtos</h1>
    <div id="produtos-container"></div>

    <h2>Carrinho</h2>
    <ul id="carrinho"></ul>
    <button id="finalizar-pedido">Finalizar Pedido</button>

    <script>
        // Inicializa o Supabase
        const supabaseUrl = 'https://yixlhjlwdrbppnqffirg.supabase.co';
        const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InlpeGxoamx3ZHJicHBucWZmaXJnIiwicm9zZSI6ImFub24iLCJpYXQiOjE3Mjg5NTExODYsImV4cCI6MjA0NDUyNzE4Nn0.3UVbhExhEuL8PLojlc68Gw8XuQlJsqJFYN4CqUEk8Cc';
        const supabase = supabase.createClient(supabaseUrl, supabaseKey);

        const carrinho = [];

        // Função para carregar produtos do banco de dados
        async function carregarProdutos() {
            const { data, error } = await supabase
                .from('Produtos')
                .select('*');

            if (error) {
                console.error('Erro ao carregar produtos:', error);
            } else {
                mostrarProdutos(data);
            }
        }

        // Função para mostrar produtos
        function mostrarProdutos(produtos) {
            const produtosContainer = document.getElementById('produtos-container');
            produtosContainer.innerHTML = '';
            produtos.forEach(produto => {
                const div = document.createElement('div');
                div.innerHTML = `
                    <h3>${produto.nome}</h3>
                    <p>Preço: R$ ${produto.preco.toFixed(2)}</p>
                    <img src="${produto.foto_url}" alt="${produto.nome}" style="width: 100px;">
                    <button onclick="adicionarAoCarrinho('${produto.nome}', ${produto.preco})">Adicionar ao Carrinho</button>
                `;
                produtosContainer.appendChild(div);
            });
        }

        // Função para adicionar produto ao carrinho
        function adicionarAoCarrinho(nome, preco) {
            carrinho.push({ nome, preco });
            atualizarCarrinho();
        }

        // Função para atualizar a visualização do carrinho
        function atualizarCarrinho() {
            const carrinhoContainer = document.getElementById('carrinho');
            carrinhoContainer.innerHTML = '';
            carrinho.forEach(produto => {
                const li = document.createElement('li');
                li.textContent = `${produto.nome} - R$ ${produto.preco.toFixed(2)}`;
                carrinhoContainer.appendChild(li);
            });
        }

        // Função para finalizar o pedido
        document.getElementById('finalizar-pedido').addEventListener('click', async () => {
            for (const produto of carrinho) {
                const { data, error } = await supabase
                    .from('Pedidos')
                    .insert([{ nome: produto.nome, preco: produto.preco }]);

                if (error) {
                    console.error('Erro ao finalizar o pedido:', error);
                } else {
                    console.log('Pedido finalizado:', data);
                }
            }
            carrinho.length = 0; // Limpa o carrinho
            atualizarCarrinho();
            alert('Pedido finalizado com sucesso!');
        });

        // Carrega os produtos quando a página é carregada
        window.onload = carregarProdutos;
    </script>
</body>
</html>